using SentryParser;

namespace SentryParserUnitTests
{
    public class EnvelopeParserTests
    {
        [Fact]
        public void CanParseEnvelope_1()
        {
            var input = """
            {"event_id":"9ec79c33ec9942ab8353589fcb2e04dc","dsn":"https://e12d836b15bb49d7bbf99e64295d995b:@sentry.io/42"}
            {"type":"attachment","length":10,"content_type":"text/plain","filename":"hello.txt"}
            \xef\xbb\xbfHello\r\n
            {"type":"event","length":41,"content_type":"application/json","filename":"application.log"}
            {"message":"hello world","level":"error"}
            """;

            var result = EnvelopeParser.Parse(input);

            Assert.Equal(2, result.Count());
        }
        
        [Fact]
        public void CanParseEnvelope_2()
        {
            var input = """
            {"event_id":"9ec79c33ec9942ab8353589fcb2e04dc"}
            {"type":"attachment","length":0}
            
            {"type":"attachment","length":0}
            
            """;

            var result = EnvelopeParser.Parse(input).ToList();

            Assert.Equal(2, result.Count);

            Assert.Empty(result[0].Content);
        }
        
        [Fact]
        public void CanParseEnvelope_3()
        {
            var input = """
            {"event_id":"9ec79c33ec9942ab8353589fcb2e04dc"}
            {"type":"attachment"}
            helloworld
            """;

            var result = EnvelopeParser.Parse(input).ToList();

            Assert.Single(result);

            Assert.NotEmpty(result[0].Content);
        }

        [Fact]
        public void CanParseEnvelope_4()
        {
            var input = """
                {"sdk":{"name":"sentry.dotnet","version":"4.2.1"},"event_id":"4f3282912a504e7e8922798c9f9f2d24","trace":{"trace_id":"94a0e6ead148486cb79908d83f5168b2","public_key":"77ac1b9bc6154546869205be7dda25b5","sampled":"true","sample_rate":"1","release":"SentryErrorSender@1.0.0","environment":"development","transaction":"GET /WeatherForecast"},"sent_at":"2024-04-01T10:35:46.121034+00:00"}
                {"type":"event","length":18461}
                {"modules":{"System.Private.CoreLib":"8.0.0.0","SentryErrorSender":"1.0.0.0","System.Runtime":"8.0.0.0","Microsoft.AspNetCore":"8.0.0.0","Microsoft.Extensions.Hosting.Abstractions":"8.0.0.0","Microsoft.Extensions.DependencyInjection.Abstractions":"8.0.0.0","Microsoft.Extensions.Logging.Abstractions":"8.0.0.0","Microsoft.Extensions.Diagnostics.Abstractions":"8.0.0.0","Microsoft.Extensions.Configuration.Abstractions":"8.0.0.0","Microsoft.AspNetCore.Http.Abstractions":"8.0.0.0","Microsoft.AspNetCore.Routing":"8.0.0.0","System.ComponentModel":"8.0.0.0","Microsoft.Extensions.Features":"8.0.0.0","Microsoft.AspNetCore.Hosting.Abstractions":"8.0.0.0","Microsoft.AspNetCore.Hosting":"8.0.0.0","Sentry.AspNetCore":"4.2.1.0","Sentry.Extensions.Logging":"4.2.1.0","Sentry":"4.2.1.0","System.Net.Primitives":"8.0.0.0","System.IO.Compression":"8.0.0.0","System.Text.Json":"8.0.0.0","Microsoft.AspNetCore.Mvc":"8.0.0.0","Microsoft.AspNetCore.Mvc.Core":"8.0.0.0","Microsoft.AspNetCore.Mvc.ApiExplorer":"8.0.0.0","Swashbuckle.AspNetCore.SwaggerGen":"6.4.0.0","Microsoft.AspNetCore.HttpsPolicy":"8.0.0.0","Microsoft.AspNetCore.Authorization.Policy":"8.0.0.0","Swashbuckle.AspNetCore.Swagger":"6.4.0.0","Swashbuckle.AspNetCore.SwaggerUI":"6.4.0.0","Microsoft.Extensions.Configuration":"8.0.0.0","Microsoft.Extensions.Primitives":"8.0.0.0","Microsoft.Extensions.Hosting":"8.0.0.0","System.Collections":"8.0.0.0","System.Threading":"8.0.0.0","Microsoft.Extensions.Configuration.EnvironmentVariables":"8.0.0.0","Microsoft.Extensions.FileProviders.Abstractions":"8.0.0.0","Microsoft.Extensions.FileProviders.Physical":"8.0.0.0","Microsoft.Extensions.Configuration.FileExtensions":"8.0.0.0","Microsoft.Extensions.Options":"8.0.0.0","Microsoft.Extensions.Logging":"8.0.0.0","Microsoft.Extensions.Diagnostics":"8.0.0.0","System.Diagnostics.DiagnosticSource":"8.0.0.0","Microsoft.Extensions.Configuration.Binder":"8.0.0.0","Microsoft.Extensions.Configuration.Json":"8.0.0.0","System.Memory":"8.0.0.0","System.Linq":"8.0.0.0","System.IO.FileSystem.Watcher":"8.0.0.0","System.ComponentModel.Primitives":"8.0.0.0","System.Collections.Concurrent":"8.0.0.0","System.Threading.Overlapped":"8.0.0.0","System.Runtime.InteropServices":"8.0.0.0","Microsoft.Win32.Primitives":"8.0.0.0","System.Text.Encoding.Extensions":"8.0.0.0","Microsoft.Extensions.Configuration.UserSecrets":"8.0.0.0","Microsoft.Extensions.Logging.EventLog":"8.0.0.0","Microsoft.Extensions.Logging.Configuration":"8.0.0.0","Microsoft.Extensions.Options.ConfigurationExtensions":"8.0.0.0","Microsoft.Extensions.Logging.Console":"8.0.0.0","Microsoft.Extensions.Logging.Debug":"8.0.0.0","Microsoft.Extensions.Logging.EventSource":"8.0.0.0","System.Diagnostics.Tracing":"8.0.0.0","Microsoft.Extensions.DependencyInjection":"8.0.0.0","Microsoft.AspNetCore.Server.Kestrel.Core":"8.0.0.0","Microsoft.AspNetCore.Server.Kestrel":"8.0.0.0","Microsoft.AspNetCore.Server.Kestrel.Transport.Quic":"8.0.0.0","Microsoft.AspNetCore.Server.Kestrel.Transport.NamedPipes":"8.0.0.0","System.Net.Quic":"8.0.0.0","System.Net.Sockets":"8.0.0.0","Microsoft.Win32.Registry":"8.0.0.0","Microsoft.AspNetCore.Server.IIS":"8.0.0.0","Microsoft.AspNetCore.Server.IISIntegration":"8.0.0.0","Microsoft.AspNetCore.Http":"8.0.0.0","Microsoft.AspNetCore.Connections.Abstractions":"8.0.0.0","Microsoft.AspNetCore.Server.Kestrel.Transport.Sockets":"8.0.0.0","Microsoft.AspNetCore.Hosting.Server.Abstractions":"8.0.0.0","Microsoft.Extensions.ObjectPool":"8.0.0.0","Microsoft.AspNetCore.HostFiltering":"8.0.0.0","Microsoft.AspNetCore.HttpOverrides":"8.0.0.0","Microsoft.AspNetCore.Routing.Abstractions":"8.0.0.0","System.ObjectModel":"8.0.0.0","Microsoft.Extensions.Http":"8.0.0.0","System.Runtime.Loader":"8.0.0.0","Microsoft.AspNetCore.Mvc.Abstractions":"8.0.0.0","Microsoft.AspNetCore.Authentication.Core":"8.0.0.0","Microsoft.AspNetCore.Authentication.Abstractions":"8.0.0.0","System.Security.Claims":"8.0.0.0","Microsoft.AspNetCore.Authorization":"8.0.0.0","Microsoft.AspNetCore.Mvc.Cors":"8.0.0.0","Microsoft.AspNetCore.Cors":"8.0.0.0","Microsoft.AspNetCore.Mvc.DataAnnotations":"8.0.0.0","Microsoft.OpenApi":"1.2.3.0","Microsoft.Extensions.Localization.Abstractions":"8.0.0.0","Microsoft.AspNetCore.Http.Extensions":"8.0.0.0","System.Console":"8.0.0.0","System.Threading.Thread":"8.0.0.0","System.Text.RegularExpressions":"8.0.0.0","System.Reflection.Emit.Lightweight":"8.0.0.0","System.Reflection.Emit.ILGeneration":"8.0.0.0","System.Reflection.Primitives":"8.0.0.0","System.Net.WebProxy":"8.0.0.0","System.Private.Uri":"8.0.0.0","System.Diagnostics.Process":"8.0.0.0","System.Diagnostics.StackTrace":"8.0.0.0","System.Net.Http":"8.0.0.0","System.Diagnostics.EventLog":"8.0.0.0","System.Collections.Specialized":"8.0.0.0","System.ComponentModel.TypeConverter":"8.0.0.0","System.Threading.ThreadPool":"8.0.0.0","System.IO.Pipelines":"8.0.0.0","netstandard":"2.1.0.0","System.Text.Encodings.Web":"8.0.0.0","System.Runtime.Intrinsics":"8.0.0.0","System.Numerics.Vectors":"8.0.0.0","Microsoft.Net.Http.Headers":"8.0.0.0","Microsoft.AspNetCore.Http.Features":"8.0.0.0","System.Linq.Expressions":"8.0.0.0","System.Runtime.Numerics":"8.0.0.0","System.ComponentModel.Annotations":"8.0.0.0","Microsoft.AspNetCore.Metadata":"8.0.0.0","Microsoft.AspNetCore.Diagnostics":"8.0.0.0","Microsoft.AspNetCore.Authentication":"8.0.0.0","Microsoft.AspNetCore.StaticFiles":"8.0.0.0","Microsoft.Extensions.FileProviders.Embedded":"8.0.0.0","Microsoft.AspNetCore.Diagnostics.Abstractions":"8.0.0.0","System.Security.Cryptography":"8.0.0.0","System.Collections.NonGeneric":"8.0.0.0","System.Net.WebSockets":"8.0.0.0","Microsoft.AspNetCore.WebUtilities":"8.0.0.0","System.Reflection.Metadata":"8.0.0.0","System.Collections.Immutable":"8.0.0.0","System.IO.MemoryMappedFiles":"8.0.0.0","System.Net.Security":"8.0.0.0","System.Net.NameResolution":"8.0.0.0","System.Security.Principal.Windows":"8.0.0.0","System.IO.FileSystem.DriveInfo":"8.0.0.0"},"event_id":"4f3282912a504e7e8922798c9f9f2d24","timestamp":"2024-04-01T10:35:17.6365373+00:00","logentry":{"message":"An unhandled exception has occurred while executing the request.","formatted":"An unhandled exception has occurred while executing the request."},"logger":"Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddleware","platform":"csharp","server_name":"STEVE-DESKTOP","release":"SentryErrorSender@1.0.0","exception":{"values":[{"type":"System.Exception","value":"Testing test","module":"System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e","thread_id":62,"stacktrace":{"frames":[{"function":"async Task DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)","in_app":false,"package":"Microsoft.AspNetCore.Diagnostics, Version=8.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60","instruction_addr":"0x82","addr_mode":"rel:7","function_id":"0x1d6"},{"function":"async Task SentryTracingMiddleware.InvokeAsync(HttpContext context) x 2","in_app":false,"package":"Sentry.AspNetCore, Version=4.2.1.0, Culture=neutral, PublicKeyToken=fba2ec45388e2af0","instruction_addr":"0x233","addr_mode":"rel:6","function_id":"0xaa"},{"function":"async Task AuthenticationMiddleware.Invoke(HttpContext context)","in_app":false,"package":"Microsoft.AspNetCore.Authentication, Version=8.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60","instruction_addr":"0x3be","addr_mode":"rel:5","function_id":"0x142"},{"function":"async Task SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)","in_app":false,"package":"Swashbuckle.AspNetCore.Swagger, Version=6.4.0.0, Culture=neutral, PublicKeyToken=62657d7474907593","instruction_addr":"0x8e","addr_mode":"rel:4","function_id":"0x1c"},{"function":"async Task SwaggerUIMiddleware.Invoke(HttpContext httpContext)","in_app":false,"package":"Swashbuckle.AspNetCore.SwaggerUI, Version=6.4.0.0, Culture=neutral, PublicKeyToken=4232c99127b3c254","instruction_addr":"0x1ce","addr_mode":"rel:3","function_id":"0x7c"},{"function":"async Task AuthorizationMiddleware.Invoke(HttpContext context)","in_app":false,"package":"Microsoft.AspNetCore.Authorization.Policy, Version=8.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60","instruction_addr":"0x2eb","addr_mode":"rel:2","function_id":"0x55"},{"function":"async Task ResourceInvoker.InvokeAsync()\u002BAwaited(?) x 2","in_app":false,"package":"Microsoft.AspNetCore.Mvc.Core, Version=8.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60","instruction_addr":"0x77","addr_mode":"rel:1","function_id":"0x1083"},{"function":"async Task ResourceInvoker.InvokeFilterPipelineAsync()\u002BAwaited(?)","in_app":false,"package":"Microsoft.AspNetCore.Mvc.Core, Version=8.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60","instruction_addr":"0x65","addr_mode":"rel:1","function_id":"0x1087"},{"function":"Task ControllerActionInvoker.InvokeInnerFilterAsync()","in_app":false,"package":"Microsoft.AspNetCore.Mvc.Core, Version=8.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60","instruction_addr":"0xa","addr_mode":"rel:1","function_id":"0x9c5"},{"function":"Task ControllerActionInvoker.Next(ref State next, ref Scope scope, ref object state, ref bool isCompleted)","in_app":false,"package":"Microsoft.AspNetCore.Mvc.Core, Version=8.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60","instruction_addr":"0x39a","addr_mode":"rel:1","function_id":"0x9c1"},{"function":"void ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)","in_app":false,"package":"Microsoft.AspNetCore.Mvc.Core, Version=8.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60","instruction_addr":"0x2d","addr_mode":"rel:1","function_id":"0x9c6"},{"function":"Task ControllerActionInvoker.InvokeNextActionFilterAsync()","in_app":false,"package":"Microsoft.AspNetCore.Mvc.Core, Version=8.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60","instruction_addr":"0xa","addr_mode":"rel:1","function_id":"0x9c2"},{"function":"Task ControllerActionInvoker.Next(ref State next, ref Scope scope, ref object state, ref bool isCompleted)","in_app":false,"package":"Microsoft.AspNetCore.Mvc.Core, Version=8.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60","instruction_addr":"0x33a","addr_mode":"rel:1","function_id":"0x9c1"},{"function":"Task ControllerActionInvoker.InvokeActionMethodAsync()","in_app":false,"package":"Microsoft.AspNetCore.Mvc.Core, Version=8.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60","instruction_addr":"0x0","addr_mode":"rel:1","function_id":"0x9c4"},{"function":"ValueTask\u003CIActionResult\u003E SyncObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, object controller, object[] arguments)","in_app":false,"package":"Microsoft.AspNetCore.Mvc.Core, Version=8.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60","instruction_addr":"0xb","addr_mode":"rel:1","function_id":"0xfe8"},{"function":"object lambda_method2(Closure, object, object[])","in_app":false},{"filename":"Controllers\\WeatherForecastController.cs","function":"IEnumerable\u003CWeatherForecast\u003E WeatherForecastController.Get()","lineno":24,"colno":13,"abs_path":"C:\\Users\\StephenBrown\\dev\\SentryErrorSender\\SentryErrorSender\\Controllers\\WeatherForecastController.cs","in_app":false,"package":"SentryErrorSender, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null","instruction_addr":"0xb","addr_mode":"rel:0","function_id":"0xc"}]},"mechanism":{"type":"ExceptionHandlerMiddleware","handled":false}}]},"level":"error","transaction":"GET /WeatherForecast","request":{"env":{"REMOTE_ADDR":"::1","SERVER_NAME":"STEVE-DESKTOP","SERVER_PORT":"5172"},"headers":{"Accept":"text/html,application/xhtml\u002Bxml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7","Connection":"keep-alive","Host":"localhost:5172","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.0.0 Safari/537.36","Accept-Encoding":"gzip, deflate, br, zstd","Accept-Language":"en-US,en;q=0.9,fr;q=0.8","Cache-Control":"max-age=0","Cookie":"messages=.eJxtzEEKhDAMAMCvhJyDyIL3BZ_gUaRUN5ZIm4Cpir93H-B1DjOOGMLmpqGwe0yM1NKnJexNV9lLrGIKXKJkcNYK1cArn_ydd7u0mVODhDjR69MRDsey_GU9cr7BJSn_QBSivzbTAwdpMQ4:1rr3R5:2HITq9hCau6Z0CWSOwp0duqCNcoQ-LgdNVms_oUMycs; csrftoken=4IQ4N9Dokzj11kFJyxJveQNaCJAbJblp; sessionid=jpr9seefwp3ry1d4wr99jmyj9r1bvsf7","Upgrade-Insecure-Requests":"1","sec-ch-ua":"\u0022Google Chrome\u0022;v=\u0022123\u0022, \u0022Not:A-Brand\u0022;v=\u00228\u0022, \u0022Chromium\u0022;v=\u0022123\u0022","sec-ch-ua-mobile":"?0","sec-ch-ua-platform":"\u0022Windows\u0022","DNT":"1","Sec-Fetch-Site":"none","Sec-Fetch-Mode":"navigate","Sec-Fetch-User":"?1","Sec-Fetch-Dest":"document"},"url":"http://localhost:5172/weatherforecast","method":"GET","cookies":"messages=.eJxtzEEKhDAMAMCvhJyDyIL3BZ_gUaRUN5ZIm4Cpir93H-B1DjOOGMLmpqGwe0yM1NKnJexNV9lLrGIKXKJkcNYK1cArn_ydd7u0mVODhDjR69MRDsey_GU9cr7BJSn_QBSivzbTAwdpMQ4:1rr3R5:2HITq9hCau6Z0CWSOwp0duqCNcoQ-LgdNVms_oUMycs; csrftoken=4IQ4N9Dokzj11kFJyxJveQNaCJAbJblp; sessionid=jpr9seefwp3ry1d4wr99jmyj9r1bvsf7"},"contexts":{"Current Culture":{"name":"en-GB","display_name":"English (United Kingdom)","calendar":"GregorianCalendar"},"Dynamic Code":{"Compiled":true,"Supported":true},"Memory Info":{"allocated_bytes":32871304,"high_memory_load_threshold_bytes":61437586636,"total_available_memory_bytes":68263985152,"finalization_pending_count":0,"compacted":false,"concurrent":false,"pause_durations":[0,0]},"ThreadPool Info":{"min_worker_threads":32,"min_completion_port_threads":1,"max_worker_threads":32767,"max_completion_port_threads":1000,"available_worker_threads":32766,"available_completion_port_threads":1000},"app":{"type":"app","app_start_time":"2024-03-31T22:41:56.5924659+00:00","in_foreground":false},"device":{"type":"device","timezone":"W. Europe Standard Time","timezone_display_name":"(UTC\u002B01:00) Amsterdam, Berlin, Bern, Rome, Stockholm, Vienna","boot_time":"2024-03-30T16:19:33.6550035+00:00"},"os":{"type":"os","raw_description":"Microsoft Windows 10.0.22631"},"runtime":{"type":"runtime","name":".NET","version":"8.0.3","raw_description":".NET 8.0.3","identifier":"win-x64"},"trace":{"type":"trace","span_id":"c7aa77e3ff258815","parent_span_id":"840dabe718e87f32","trace_id":"94a0e6ead148486cb79908d83f5168b2"}},"user":{"ip_address":"::1"},"environment":"development","sdk":{"packages":[{"name":"nuget:sentry.dotnet","version":"4.2.1"},{"name":"nuget:Sentry.AspNetCore","version":"4.2.1"}],"name":"sentry.dotnet.aspnetcore","version":"4.2.1"},"tags":{"eventId":"UnhandledException","ActionId":"7340145f-d078-4f9a-ae03-53d49da7b956","ConnectionId":"0HN2HQF2R7N0N","RequestId":"0HN2HQF2R7N0N:00000001","route.controller":"WeatherForecast","ActionName":"SentryErrorSender.Controllers.WeatherForecastController.Get (SentryErrorSender)","route.action":"Get"},"debug_meta":{"images":[{"type":"pe_dotnet","debug_id":"64182748-2664-4e00-80ab-ed1f7300cb79-f69af7ee","debug_checksum":"SHA256:482718646426006e00abed1f7300cb79eef79a76d963b887073021857b071be2","debug_file":"C:\\Users\\StephenBrown\\dev\\SentryErrorSender\\SentryErrorSender\\obj\\Debug\\net8.0\\SentryErrorSender.pdb","code_id":"969481D78000","code_file":"C:\\Users\\StephenBrown\\dev\\SentryErrorSender\\SentryErrorSender\\bin\\Debug\\net8.0\\SentryErrorSender.dll"},{"type":"pe_dotnet","debug_id":"add17da3-a5b8-49f0-a336-04880d8e76bd-d91177cc","debug_checksum":"SHA256:a37dd1adb8a5f0e9e33604880d8e76bdcc7711d97b5b4ba80c66fcb880d70c06","debug_file":"/_/artifacts/obj/Microsoft.AspNetCore.Mvc.Core/Release/net8.0/Microsoft.AspNetCore.Mvc.Core.pdb","code_id":"BAE33FC81dc000","code_file":"C:\\Program Files\\dotnet\\shared\\Microsoft.AspNetCore.App\\8.0.3\\Microsoft.AspNetCore.Mvc.Core.dll"},{"type":"pe_dotnet","debug_id":"2084a24f-ca9b-43a4-a19d-df4642543c78-c60e3fd6","debug_checksum":"SHA256:4fa284209bcaa423a19ddf4642543c78d63f0ec6e5fd05ec9f53cf0d73a77ee5","debug_file":"/_/artifacts/obj/Microsoft.AspNetCore.Authorization.Policy/Release/net8.0/Microsoft.AspNetCore.Authorization.Policy.pdb","code_id":"B42320F411000","code_file":"C:\\Program Files\\dotnet\\shared\\Microsoft.AspNetCore.App\\8.0.3\\Microsoft.AspNetCore.Authorization.Policy.dll"},{"type":"pe_dotnet","debug_id":"b663cfa8-0bf4-455b-8190-32b9778ad382-916118db","debug_checksum":"SHA256:a8cf63b6f40b5bf5819032b9778ad382db186191107edf84b1448d3413458235","debug_file":"C:\\projects\\ahoy\\src\\Swashbuckle.AspNetCore.SwaggerUI\\obj\\Release\\net6.0\\Swashbuckle.AspNetCore.SwaggerUI.pdb","code_id":"8C285F5D348000","code_file":"C:\\Users\\StephenBrown\\dev\\SentryErrorSender\\SentryErrorSender\\bin\\Debug\\net8.0\\Swashbuckle.AspNetCore.SwaggerUI.dll"},{"type":"pe_dotnet","debug_id":"835f47b0-6827-44ab-a444-d80ab1e8f62a-a4942041","debug_checksum":"SHA256:b0475f832768abb42444d80ab1e8f62a41209424ea3bfc32811da3c75b2890b6","debug_file":"C:\\projects\\ahoy\\src\\Swashbuckle.AspNetCore.Swagger\\obj\\Release\\net6.0\\Swashbuckle.AspNetCore.Swagger.pdb","code_id":"B616FEC4a000","code_file":"C:\\Users\\StephenBrown\\dev\\SentryErrorSender\\SentryErrorSender\\bin\\Debug\\net8.0\\Swashbuckle.AspNetCore.Swagger.dll"},{"type":"pe_dotnet","debug_id":"a12dc369-111b-48c7-88a8-629c1fbeb016-b45877e7","debug_checksum":"SHA256:69c32da11b11c71888a8629c1fbeb016e77758b4aeec124096c93a2eb78410e8","debug_file":"/_/artifacts/obj/Microsoft.AspNetCore.Authentication/Release/net8.0/Microsoft.AspNetCore.Authentication.pdb","code_id":"E51F95BD24000","code_file":"C:\\Program Files\\dotnet\\shared\\Microsoft.AspNetCore.App\\8.0.3\\Microsoft.AspNetCore.Authentication.dll"},{"type":"pe_dotnet","debug_id":"afbf2dc1-47bb-45ff-9bb2-30c29f6c171e-838c80aa","debug_checksum":"SHA256:c12dbfafbb47ff65dbb230c29f6c171eaa808c03a4a3a20b6818fecd980ddb37","debug_file":"/_/src/Sentry.AspNetCore/obj/Release/net8.0/Sentry.AspNetCore.pdb","code_id":"C6E91B6D18000","code_file":"C:\\Users\\StephenBrown\\dev\\SentryErrorSender\\SentryErrorSender\\bin\\Debug\\net8.0\\Sentry.AspNetCore.dll"},{"type":"pe_dotnet","debug_id":"c1f793e6-ba31-484a-a160-296fd9ed4cf7-d869df45","debug_checksum":"SHA256:e693f7c131ba4a282160296fd9ed4cf745df695858bcb7b875a44247ac20dedd","debug_file":"/_/artifacts/obj/Microsoft.AspNetCore.Diagnostics/Release/net8.0/Microsoft.AspNetCore.Diagnostics.pdb","code_id":"BBC5492A6b000","code_file":"C:\\Program Files\\dotnet\\shared\\Microsoft.AspNetCore.App\\8.0.3\\Microsoft.AspNetCore.Diagnostics.dll"}]}}
                {"type":"client_report","length":255}
                {"timestamp":"2024-04-01T10:35:46.1209893+00:00","discarded_events":[{"reason":"network_error","category":"default","quantity":2},{"reason":"network_error","category":"error","quantity":1},{"reason":"network_error","category":"transaction","quantity":2}]}
                
                """;

            var result = EnvelopeParser.Parse(input).ToList();

            Assert.Equal(2, result.Count);

            Assert.NotEmpty(result[0].Content);
        }
    }
}